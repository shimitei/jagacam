<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>JAGA-cam</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
window.URL = window.URL || window.webkitURL;
navigator.getUserMedia = ( navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);

if (!navigator.getUserMedia) {
    console.log("getUserMedia not supported");
    alert("getUserMedia not supported");
}

window.onload = function() {
  navigator.mediaDevices.enumerateDevices().then(function(sourcesInfo) {
    var videoSroucesArray = sourcesInfo.filter(function(elem) {
      return elem.kind == 'videoinput';
    });
    render(videoSroucesArray);
  });

  function render(videoSroucesArray) {
    var option = $.map(videoSroucesArray, function(value,idx) {
      $option = $('<option>', {
        value:value.deviceId,
        text:value.label || idx
      });
      return $option;
    });
    $('#camera').append(option);
    $('#camera').change(function(){
      var constraints = {
        video: {
            optional: [{
                sourceId: $(this).val()
            }]
        },
        audio: false
      };
      start(constraints);
    });
    start({video: true, audio: false});
  }
}

var currentStream;
function start(constraints) {
  if (currentStream) {
    currentStream.getVideoTracks().forEach(function(devise) {
      devise.stop();
    });
    currentStream = null;
  }

  navigator.getUserMedia (
    constraints,
    function(stream) {
      currentStream = stream;
      var video = document.getElementById('video');
      video.src = window.URL.createObjectURL(stream);
      video.play();
    },
    function(err) {
      console.log(err);
    }
  );
}
    </script>
</head>

<body>
    <div class="form-group">
        <video id="video" width="320" height="240"/>
    </div>
    <div class="form-group">
        <div class="form-inline">
            <label>CAMERA: </label>
            <select id="camera" class="form-control"/>
        </div>
    </div>
</body>

</html>